<!DOCTYPE html>
<html ng-app="sgtApp">
<head>
    <meta name="viewport" content="initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- JQuery AutoComplete plugin -->
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>-->

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
    <script src="ang.js"></script>
    <script src="controllers.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body ng-controller="appController as ac">
    <div class="container">
        <!-- Header & Grade Average -->
        <div class="row">
            <div class="page-header">
                <!-- only show this element when it isn't on mobile -->
                <h1 class="hidden-xs">
                    Student Grade Table
                    <small class="pull-right">
                        Grade Average: &nbsp;
                    <span class="label label-default pull-right">
                        {{ac.calculateAverage()}}
                    </span>
                    </small>
                </h1>
                <!-- only show this element when the user gets to a mobile version -->
                <h3 class="visible-xs">
                    Student Grade Table
                    <small class="col-xs-12 text-right">
                        Grade Average:
                    <span class="avgGrade label label-default">
                        {{ac.calculateAverage()}}
                    </span>
                    </small>
                </h3>
            </div>
        </div>
        <!-- find the minimum/lowest & maximum/highest grade -->
        <div ng-hide="true" ng-bind="ac.gradeMin()"></div>
        <div ng-hide="true" ng-bind="ac.gradeMax();"></div>
        <div class="row">
            <!-- Add Student Data Form -->
            <!-- Full on mobile, align right on desktop -->
            <div role="form" class="col-xs-12 col-md-3 col-md-push-9"
                    ng-controller="formController as fc">
                <h4>
                    Add Student
                </h4>

                <!-- Name Input -->
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-user"> </span>
                        </span>
                        <input type="text" class="form-control" name="studentName"
                                placeholder="Student Name" ng-model="fc.newStudent.name">
                    </div>
                    <div class="text-danger valError" ng-show="fc.nameError;">
                        Enter student name of at least two characters.
                    </div>
                </div>
                <!-- Course Input -->
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-list-alt"> </span>
                        </span>
                        <input type="text" class="form-control" name="course"
                                placeholder="Student Course" ng-model="fc.newStudent.course">
                    </div>
                    <div class="text-danger valError" ng-show="fc.courseError;">
                        Enter course name of at least two characters.
                    </div>
                </div>
                <!-- Grade Input -->
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-education"> </span>
                        </span>
                        <input type="number" class="form-control" name="studentGrade"
                                placeholder="Student Grade" ng-model="fc.newStudent.grade">
                    </div>
                    <div class="text-danger valError" ng-show="fc.gradeError;">
                        Enter grade from 0 - 100.
                    </div>
                </div>
                <!-- Submit Buttons -->
                <button type="button" class="btn btn-success" ng-click="fc.addStudent()">
                    Add
                </button>
                <button type="button" class="btn btn-default"
                        ng-click="fc.resetForm();">
                    Cancel
                </button>
                <!-- hidden on small and x-small screen -->
                <button type="button" class="btn btn-primary hidden-sm hidden-xs"
                        ng-click="ac.reloadStudents();">
                    Reload Student Data
                </button>
                <!-- visible on small and x-small screen -->
                <button type="button" class="btn btn-primary visible-sm visible-xs pull-right"
                        ng-click="ac.reloadStudents();">
                    Reload Student Data
                </button>
                <p class="text-danger addError" ng-show="fc.addStudentError();">
                    Failed to Add Student <br> Please Try Again
                </p>
                <hr>
            </div>
            <!-- Full on mobile, align left on desktop -->
            <div class="col-xs-12 col-md-9 col-md-pull-3" ng-controller="studentListController as sl">
                <!-- Error message to display if data can't be retrieved -->
                <p class="text-danger loadError" ng-show="sl.loadError()">
                    Student Data Failed to Load | Please Try Later
                </p>
                <!-- Filter data shown -->
                <div class="form-group">
                    <div class="input-group">
                        <!-- Filter Dropdown Category Selector -->
                        <div class="input-group-btn dropdown">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-filter"></span>
                                <span ng-show="sl.filterFieldDisplay != '';">{{sl.filterFieldDisplay}}</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">
                                    Filter by ...
                                </li>
                                <li>
                                    <a href=""
                                            ng-click="sl.filterField = 'name'; sl.filterFieldDisplay = 'Student Name';">
                                        Name
                                    </a>
                                </li>
                                <li>
                                    <a href=""
                                            ng-click="sl.filterField = 'course'; sl.filterFieldDisplay = 'Student Course';">
                                        Course
                                    </a>
                                </li>
                                <li>
                                    <a href=""
                                            ng-click="sl.filterField = 'grade'; sl.filterFieldDisplay = 'Student Grade';">
                                        Grade
                                    </a>
                                </li>
                                <li>
                                    <a href="" ng-click="sl.filterField = '$'; sl.filterFieldDisplay = '';">
                                        All Columns
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <!-- Filter Input -->
                        <input type="text" class="form-control" placeholder="Filter..."
                                ng-model="sl.filterText[sl.filterField]">
                        <!-- Clear Filter Button -->
                        <span class="input-group-btn">
                            <button class="btn" type="button"
                                    ng-class="{'btn-default':(sl.filterText[sl.filterField].length == 0 || sl.filterText[sl.filterField] == undefined),
                                    'btn-primary':(sl.filterText[sl.filterField].length > 0)}"
                                    ng-click="sl.filterText = {}; sl.filterField = '$'; sl.filterFieldDisplay = '';">
                                Clear Filter
                            </button>
                        </span>
                    </div>
                </div>
                <!-- Button to clear sorting -->
                <button type="button" class="btn btn-primary pull-right"
                        ng-hide="sl.sortField == '';"
                        ng-click="sl.sortField = ''; sl.reverseSort = false;">
                    Clear Sort
                </button>
                <!-- Table to display student data -->
                <table class="table">
                    <thead>
                        <tr>
                            <th ng-click="sl.sorting('name');" ng-class="{'sorted':sl.sortField == 'name'}">
                                <a href="">
                                    Student Name
                                    <span class="glyphicon glyphicon-triangle-top"
                                            ng-show="(sl.sortField != 'name')||
                                        (sl.sortField == 'name' && sl.reverseSort == false);">
                                    </span>
                                    <span class="glyphicon glyphicon-triangle-bottom"
                                            ng-show="(sl.sortField != 'name')||
                                        (sl.sortField == 'name' && sl.reverseSort == true);">
                                    </span>
                                </a>
                            </th>
                            <th ng-click="sl.sorting('course');" ng-class="{'sorted':sl.sortField == 'course'}">
                                <a href="">
                                    Student Course
                                    <span class="glyphicon glyphicon-triangle-top"
                                            ng-show="(sl.sortField != 'course')||
                                        (sl.sortField == 'course' && sl.reverseSort == false);">
                                    </span>
                                    <span class="glyphicon glyphicon-triangle-bottom"
                                            ng-show="(sl.sortField != 'course')||
                                        (sl.sortField == 'course' && sl.reverseSort == true);">
                                    </span>
                                </a>
                            </th>
                            <th ng-click="sl.sorting('grade');" ng-class="{'sorted':sl.sortField == 'grade'}">
                                <a href="">
                                    Student Grade
                                    <span class="glyphicon glyphicon-triangle-top"
                                            ng-show="(sl.sortField != 'grade')||
                                        (sl.sortField == 'grade' && sl.reverseSort == false);">
                                    </span>
                                    <span class="glyphicon glyphicon-triangle-bottom"
                                            ng-show="(sl.sortField != 'grade')||
                                        (sl.sortField == 'grade' && sl.reverseSort == true);">
                                    </span>
                                </a>
                            </th>
                            <th>
                                Operations
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-show="sl.studentData().length == 0 && !(sl.loadError())">
                            <td colspan="4" class="loadImage">
                                <img src="images/loading.gif">
                            </td>
                        </tr>
                        <tr
                                ng-repeat="student in sl.studentData() | filter: sl.filterText | orderBy: sl.sortField: sl.reverseSort"
                                ng-class="{'minHighlight':student.grade == ac.minGrade, 'maxHighlight':student.grade == ac.maxGrade}"
                                >
                            <td>{{student.name}}</td>
                            <td>{{student.course}}</td>
                            <td>{{student.grade}}</td>
                            <td>
                                <button type="button" class="btn btn-danger"
                                        ng-click="sl.deleteStudent(student.id)">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="deleteError" ng-show="sl.deleteError();">
                    <p ng-if="sl.deleteError();" class="text-danger deleteErrorTxt">
                        Error: {{sl.errorMessage()}}
                        <button type="button" class="deleteErrorBtn" ng-click="ac.resetErrors();">
                            &times;
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

